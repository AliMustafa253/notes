What's AWS?

	On demand services.
	
	
================

can skip 3,4,5 and 12

networks = availability zones
	
--AWS Regions--
	region = cluster of data centers
	region scoped = services acc to region
	
	-where to choose aws region?
	
		- compliance with data gov and legal
		- proximity
		- Available services
		- pricing: varies per region
		
--AWS availability zone--
	usually 3 min 3 max 6.
		ap-southeast-2
		eg ap-southeast-2a,b,c
		
		- 1 or more data centers with redundant power and networking.
		- isolated from each other for disaster prevention
		- connected with high bandwidth and low latency networking -> form region
	
--Edge Locations--
	400+ point of presences.
	Content delivered to end users with low latency.
	
-some services like route 53 = global
others regional like ec2 --> aws regional services check availability per region


--IAM--
	Root account = default, should be used to create accounts/users.
	
	users = can be in multiple groups
	groups = only contain users.
	
	-- Policies--  
		= json documents assigned to them (things allowed to them)
		
		"version"
		"id" optional
		"Statement"{
			"sid"
			"Effect" : "Allow" / "deny"
			"Principal : { } --> which account/user/role it is applied to
			"action" list of actions this policy allows or denies
			"resources": list of resources which the action applies to
			"condition" conditions for policy to take effect
		
	
	***Least privilege principle.
	
	Password Policy:
		password expiry,reuse,allow iam to change own passwords,specific char tyesp
		
		MFA-Multifactor Authentication

			Management Console  ---> password + MFA-Multifactor
			AWS CLI  -> access keys
			AWS SDK -> access keys
			
	---CLI---
		access keys
		
		aws configure
		aws iam list-users
	
	---CloudShell---
		Cli on the cloud
		Saves files as well.
		download and upload files.
			in some regions only
			
	--IAM roles for Services--
		IAM roles
		--> like users but used by aws services
			EC2 instance = IAM Role ---> one entity.
				Common roles:
					EC2 Instance Roles.
					Lambda Function Roles.
					CloudFormation Roles.		
		AWS service role
	
	--IAM Security Tools--
		IAM Credentials Report (Account-level)
		IAM Access Advisor (User-level)
			See which access not used
				---> to do least priviledge
				
	***IAM groups contain only users (not other groups)
	**A statement in an IAM Policy consists of Sid, Effect, Principal, Action,
	Resource, and Condition. Version is part of the IAM Policy itself, not the statement.
			
		
===EC2====
	
	Elastic Compute Cloud = Infrastructure as a service.
	
	usecases:
		- Rent Virtual Machines. (EC2)
		- Storing data on virtual drives (EBS) 
		- Distributing load accross machines (ELB)
		- Scaling the services using an auto-scaling group (ASG)
	
	--EC2 sizing & configuration--
		- OS
		- CPU
		- RAM
		- Storage Space 
			- Network attached (EBS/EFS)
			- hardware (EC2 instance store)
		
		- Network card: speed , public ip address
		- Firewall rules: security group
		- Bootstrap script (config at start): EC2 User Data
		
	--EC2 User Data--
		bootrstrap instances using EC2 userdata script.
		bootstrapping = launching commands when a machine starts.
			script runs only once at instance first start
			EC2 user data is used to automate boot tasks such as:
				- installing updates.
				- installing softwares.
				- downloading common files.
				- anything u can think of.
		**EC2 User Data Script runs with root user
	
	t2.micro --> free tier 1 cpu 1gb memory. can run for a month t3 if not in region
	t2.2x --> not free
	...etc
	
	key pair .pem for all but .ppk for windows 8 and 7
	
	Delete on termination = EBS volume deleted
	
	Using user data run script ->
		eg install http web server. Write file that will be our server. echo
		
	AMI -> amazon machine image -> linux for us
	
	=======EC2 INSTANCE TYPES=========
	DIFF BETWEEN STORAGE OPTIMZED AND MEMORY OPTIMIZED?
	
	e.g m5.2xlarge
	m: instance class -> general
	5: generation (AWS improvers them over time)
	2xlarge: size within instance class
	
	General Purpose: M
		Good for diversity of workloads such as web servers or code repos.
		Balance b/w:
			compute
			memory
			networking
	
	Compute Optimized: C
		Good for compute intensive tasks:
			Batch processing workloads
			Media transcoding
			High performance web servers
			High performance computing (HPC)
			Scientific modeling and Machine Learning
			Dedicated Gaming Servers
			
	Memory Optimized: R -> for RAM
		Fast process large data sets in memory
			High performance, relational/non rel db
			distributed web scale cache
			in memory db optimized for Businees intelligence
			Applications performing real time processsing of big unstructued data.
			
	
	Accelerated Computing:
	
	Storage Optimized: I G or H1
		Great for storage related data on local storage.
			High frequency online transaction processing.
			Rel or NOSQL DB
			Cache for in memory db (redis)
			Data warehousing applications
			Distributed file systems
	
	=========EC2 INSTANCES PURCHASE OPTIONS===============
	
	On-demand Instances- 
		short workload predictable pricing , pay by sec
			- Highest cost but no upfront payment.
			- no long term commitment.
			SHORT TERM AND UN INTERRUPTED WORKLOADS, cant predict app behaviour
		
	Reserved (1 & 3 years)
		Reserved Instances. long workloads
		Convertible Reserved Instances. Long workloads with flexible instances
			- Up to 72% discount on on demand.
			- Reserve specific instance attributes (instance type region, tenancy OS)
			- Reservation period 1 year / 3 year (+++ discount)
			- Payment Options- No Upfront (+), Partial ++, All Upfront (+++)
			- Reserved Instances Scope - Regional or Zonal (reserve capacity in AZ)
			- Recommended for steady state usage app (db)
			- Buy and sell in Reserved Instance Marketplace
			
			COnvertible Reserved Instance.
				Can change EC2 Instance type, family,OS,Scope,Tenancy
				Up to 66% Discount
			
	Savings Plan (1 & 3 years) 
		commitment to an amount of usage long workload.
			- 72% -> Same as Reserved
			- Commit to certain type of usage (10$/hour for 1 or 3 years)
		***	- Usage beyond EC2 Savings Plans is billed at On-Demand Price
			
		***	- Locked to specific family and AWS Region ( e.g M5 in us-east-1)
			- Flexible Across :
				- Instance size (e.g, m5.xlarge,m5.2xlarge)
				- OS
				- Tenancy (Host,Dedicated,Default)
				
	Spot Instances - 
		short workloads, cheap, can lose instances ( less reliable )
			- Up to 90% discount.
			- Max price set as spot price.
			- MOST cost efficient.
			
			*** USEFUL FOR:
				Batch Jobs
				Data Analysis
				Image Processing
				Any Distributed Workloads
				Workloads with a flexible start and end time
			
			- NOT FOR CRITICAL JOBS LIKE DB
	
	Dedicated Hosts- 
		book an entire physical server, control instance placement.
			- Physical Server with EC2 Instance capacity fully dedicated
			- ALlows you address compliance requiremetns and use ur existing server bound licenes
			(per socket, per core, per--VM software licenes)
			
			- Purchasing options.
				On demand- pay per second
				Reserved 1 or 3 years. (No Upfront/Parital, All Upfront etc)
			- MOST expensive.
			- Useful for licensing model.
			Or compliance needs.
	
	Dedicated Instances - 
		no other customers share ur hardware. Cna share with same acc.
		-*** No control over instance placement (can move after stop/start)
		
			- MY OWN INSTANCE IN MY OWN HARDWARE.
			- Dedicated host -> allow control over lower level hardware and access to physical server
	
	Capacity Reservations - 
		reserver capacity in specific AZ for any duration
			- Always have Access to EC2 capacity when needed 
			- No time commitment. NO BILLING DISCOUNT ITSELF
			- Combine with Regional Reserved Instances and Savings plan for discounts.
			- Charged on demand rate whether you run instances  or not.
			
			Suitable for short-term uninterrupted workloads that need to be in a specific AZ
		
	-----------Spot instance requests--------------
		
		Define max spot price. get instance while current spot price < max
			2min grace period when price > max. 
				- stop or terminate 
				- Spot Block:- Block spot instance until specific time (1 to 6 hours)
					Rare situations can be reclaimed. without interruption
			
			good for resilient ML etc short work not for DB
			discount upto 90%
			
		---One time request for spot-
			as soon as spot request fulfilled -> launch instances and request finished
			max price instances, launch specs, 
		persistent
			as long as there.
			
		*** CANCEL -> open active or disabled state
		***Cancelling spot req does not terminate instances.
		cancel spot req first then terminate instance.
		
		----------Spot fleets---------
			Set of spot instances + (optional) On demand Instances
			Spot fleet try to meet target capacity with price constraints.
				- Define possible launch pools: instance type,OS,AZ
				- can have multiple launch pools.
				- Spot fleet stops launching instances when reach capacity.
				
			Strategies to allocate Spot Instances:
			****- LowestPrice: pool with lowest Price (cost optimzation, short workload)
				- Diversitifed: distributed across all pools (great for availablility, long workloads)
				- CapacityOptimized: optimal capacity for number of instances avaialble
				- priceCapacityOptimized(recommended) pools with highest cap available ,t hen select the pool with 
					lowest price (best choice for most_/
			
			--Spot fleets allow us to automatically resserve spots with lowest price.
		
			
	
	=======SECURITY GROUPS=======
		only contain allow rules.
		rules can reference by IP or by security groups.
		
		inbound traffic ---> sec group
		outbound traffic <----
		
		firewall on EC2 Instances.
			access to ports.
			authorised ip ranges - ipv4 and 6
			control inbound and outbound network.
			
		*good to maintain one speerate for ssh access
		------------------------------------
		*can have multiple instances.
		****locked down to region/VPC combination
		*live outside EC3 - if traffic blocked EC2 wont see.

		*********if timeout/not accessbile = security group error.**********
		if connection refused error -> application error or not launched
		
		inbound traffic is blocked by default.
		outbound is authorised by default.
		
		authorised specific security groups as well. multiple sec groups allowed.
		
		
		=======PORTS========
		
		22 = SSH (secure shell) - log into linux instance
		21 = FTP - upload files into a file share
		22 = SFTP upload file using SSH
		80 = HTTP - access unsecured sites
		443 = HTTPS - access secured websites
		3389 = RDP (remote desktop protocol) log into a windows instance (FOR WINDOWS)
		
		======SSH======
		secureshell protocol
			commandline interface utility --> usable in mac linux and windows 10 
			> others putty.
			> EC2 instance connect = all
		
		allows u to use ec2 ssh/control from ur machine remotely
		ec2-user = user setup itself in linux ec2 instance
		
		when using ssh. make sure ur key-pair is connected to ur account only.
		
		EC2 Instance Connect
			- temporary ssh key given.
			sometimes need to add both ipv4 and v6 in security to connect
			
		--> NEVER ENTER IAM KEY IN SSH INSTANCE ETC
		
	==================================
		private (unqiue only accross private network) 	public IP ( unique)
			private internet gateway (NAT device)
		Elastic IPs
			EC2 instance changes public IP.
			Elastic IP = fixed public IP and u own it. one instance at a time
			You can mask failure by remapping address.
			Only 5 in Elastic IP per account.
			
			---> Better = random public IP and register a DNS name
			Elastic I{ = usually poor architectural decisions.
			
		EC2 ---> private IP for internal AWS network only
		
	---------EC2 Placement Groups--------
	
		control over ec2 instance placement.
		strategy can be defined without hardware access.
			Cluster: clustere instances into low latency groupp in a single AZ
					---> great network (10gbps badnwitdh between instances)
					
					<--- if AZ fails, all instances fails at the same time.
					
					Use Case:
						Big Data Job that needs to complete fast.
						Apps that need extremely low latency and high network throughput
			
			
			Spread: spread instances across underlying hardware (max 7 instance per group per AZ)
					- for critical applications.
					
						Minimise failure risk.
						Different hardwares.
					
					---> can span across diff AZ, EC2 in diff physical hardware.
						Reduce risk in simultaneous failure
						
					<--- limited to 7 instances per AZ per placement group
					
					Use Case:
						Applications that needs to maximize high availability
						Critical Applications where each instance must be isolated from failure from each other
					
			Partition: spreads instances across many diff partitions. ( rely on diff sets of racks)
					within an AZ. Scales to 100s of EC2 instances per group (hadoop, Cassandra, Kafka)
					
				diff parititons. each partition represents diff rack.
				Up to 7 partitions per AZ. 
				Can span across multiple AZ in same region.
				Up to 100s of EC2 Instances.
				Dont share hardware rack in each partition --> each partition isolated from failure.
				EC2 metadata to see where each service is.
				Use cases -> big data apps
				
		------- Elastic Network interfaces (ENI) ------------
		logical component in a VPC representing a virtual network card
		ENI can have:
			- primary private IPv4, and multiple secondary ipv4
			- Elastic IPv4 per private IPv4
			- One or mroe security groups
			- A MAC Address
		Make ENI indepedentally and attach them to EC2 instances on failover.
		Specific to AZ
			---> can move private IPv4 to diff EC2 FOR *** FAIL OVER PURPOSES
			
		secondary ENI ---> can move from one to another. can make ez network failover
		
		---------EC2 Hibernate----------
		
			stop,terminate instances:
				STOP -> EBS INTACT
				TERMINATE -> EBS Vol set up to be destroyed is destroyed.
				
			on start,
				OS boots ec2 user data.
				App starts , cache warms up time taken
				
		Hibernate
			in-memory RAM state preserved
			instance boot much faster (OS not stopped)
			RAM is written to a file in the root EBS vol.
			Root EBS vol is encrypted
				root EBS contains RAM dump.
				as if EC2 never stopped
				
			Use cases:
				long running processing.
				Save RAM state
				Faster OS boot
		AMI- a lot instance size -> not for bare metal instances.
		***Root Volume ---> must be EBS encrypted not instance store and large
		
	To enable EC2 Hibernate, the EC2 Instance Root Volume type must be an EBS volume
	and must be encrypted to ensure the protection of sensitive content.
	
===============EC2 STORAGE===============
	-------EBS---------		Elastic Block Store
		- EBS volume is a network drive u attach to ur instances.
		- Allows instance to persist data even after termination.
		- only mounted to one instance at a time (except io1/io2)
			2 EBS can be linked to one EC2
		- bound to a specific AZ
	*NETWORK USB STICK analogy
	
	EBS Volume:
		network drive not physical drive.
			uses network to communicate --> might have latency.
			detachable from one ec2 to another.
			
		Locked in AZ.
			Move volume across --> snapshot it.
			
		have a provisioned capacity
			- billed for provisioned capacity.
			- can increase capacity over time.
			
	
	----Delete on Termination Attribute-----
		Default true on root ebs volume.
		by default any other attached ebs is not deleted (disabled)
		Use case: preserve root vol when instance is terminated etc
	
	-----EBS SNAPSHOT-----
		Backup of ur ebs volume at a point in time
		Not necessary to detach volume but recommended.
		** CAN COPY SNAPSHOT ACROSS AZ OR REGION
	
		- EBS snapshot archive.
			archive tier --> upto 75% cheaper.
			- 24 to 72 hours to restore archive.
		
		- Recycle Bin for EBS Snapshots.
			setup rules to retain deleted snapshots.
			- retenship from 1 day to 1 year.
			AZ specific retention rules inside bin
			
		- Fast Snapshot Restore (FSR)
			Force full initialization of snapstho to have no latency on first use.
		
		
	------AMI------
	
	Amazon Machine IMage.
		Customization of an EC2 instance.
			- add ur own software configuration, os, monitoring
			- faster boot/ configuration time bcus all ur softaware is pre packaged.
			
		- AMI are built for a specific region ( can be copied to other region)
			- Public AMI
			- Own AMI : maintain urself
			- AWS Marketplace AMI
		
		Start an EC2 instance and customize it.
		Stop instance for data integrity.
		Build an AMI - also creates EBS snapshots
		Launch instance from other AMIs
		
	----Ec2 Instance Store------
	****EBS limited performance as network drives.
	
	--> high performance hardware = use EC2 Instance Store.
		- Better I/O performance
		- EC2 Instance Store Lose their storage if they're stopped 
		- Good for buffer / cache / scratch data/ temp content
		- Risk of Loss if hardware fails
		- Backups and Replication ur responsibility
		
	--------EBS VOLUME TYPES--
	
		Gp2/gp3 (SSD): general purpose SSD vol that balances price and performance.
			:**** cost effective storage,low latency.
			Sys boot vol, virtual desktop, dev and tes
			1 GB - 16 Tib
				gp3:
				-> independentally set IOP and throughput while gp2 is linked together
				
					baseline of 3,000 IOPS throughput of 125MB/s
					can increase up to 16,000 and 1000 MiB/s independetly
				gp2:
					small gp2 can burt iops to 3,000
					size IOPS and vol linked.
					3 IOPS per GB. max IOPs 16,000
		
		Iol/io2 Block Express (SDD): highest performance mission critical low =-latency or high throuput workloads.
			Critical Business applications with sustained IOPS performance.
			Or application needs more than 16,000 IOPS
			Great for db workloads (sensitive to storage perf and consistency)
			
				io1 (4GB-16Tb):
					can increase PIOPS independetly from storage size
				
				io2 (4Gb-64Tb):
					sub milisecond latency
					IOPS:GB ratio of 1000:1 for max piops
					
				Supports EBS: multi attach
		
		st1 (HDD): low cost HDD vol for freq-access throughput intensive workloads.
		sc1 (HDD): lowest cost HDD vol for less freq access 
			cannot be boot volume
			125gb to 16tb
		****Throughput Optimized HDD
				Good for big data data warhouses, log processing.
				Max throughput 500Mbs IOPS 500 in st1 half in sc1
			Cold HDD (sc1:)
				for data infreq access.
				low cost imp
		
		EBS Vol characterized in SIZE | THROUGHPUT | IOPS (I/O per sec)
		Only gp2/gp3 and io1/io2 can be used as boot vol


		--EBS multi attach--
			same EBS volume to multiple EC2
			only for io1 and io2
			- read and write permissions to both.
			Use case:
				Higher app availability in clustered linux application.
				Applications must manage concurrent write operations
				one AZ obv.
			***Up to 16 EC2 instances at a time.
			cluster aware file system
			
		--EBS encryption--
		
		Data at rest encrypted.
		ALl data in flight moving b/w instance and vol is encrypted.
		All snapshots encrypted
		all vol created from snapshot encrypted.
		**Encrypt decrypt handled transparently (we do nothing)
		EBS leverages keys from KMS (AES-256)
		**Copying unecrypted snapshot allows encryption
			or create EBS volume and select encryption to make new encrypted EBS vol
		
		create ebs snapshot of vol (non encrypted ebs)
		encrypt ebs snapshot (using copy)
		create new ebs vol from snapshot 
		attached encrypted vol to original instance
		
		
	=========EFS==========
	Elastic FIle System
	
	- Managed Network File System (NFS) can be mounted on many ec2
	- multi-AZ
	- Highly available scalable, expensive (3x gp2), pay per use
	
	Use cases: content management, web serving, data sharing
	NFSv4.1 protocol.
	security group to control access to EFS
	COmpatible with linux based AMI (not WINDOWS)
	Encrypted using KMS
	standard api posix linux
	File system scales automatically pay per use
	
	EFS Scale:
		- 1000s of nfs clients, 10gbps throughput
		- Grow to petabyte scale nfs, auto
	
	Performance Mode (set at EFS creation Time)
		- General Purpose: latency use cases (webserver, CMS etc)
		- Max I/O - higher latency, throughput, highly parallel (big data, media processing)
		
	Throuhput Mode
		- bursting - 1 TB = 50mbps + burt up to 100mbps.
			Scale with storage being used
		- Provisioned - set throughput regardless of storage size, 1 gbps for 1tb storage 
			deco related to storage.
		- Elastic - automatically scales throughput up or down  based on workloads.
			Great for unpredictable workloads
			
	Storage Tiers: 		lifecycle management feature - move file after N days
	
		- Standard : for frequently accessed files.
		
		- infrequent access (EFS-IA) cost to retrieve files, lower price to store.
		
		- Archive: rarely accessed data: 50& cheaper.
		
		implement lifecycle policies to move file b/w storage tiers.
		
	Availability and durability:
		Standard: Multi AZ
		One Zone: One AZ, great for dev
	
	can save up to 90%
	
	EFS attaches Security groups itself to EC2 once connected to allow connection
	
	
	============EBS v.s EFS=============
	EBS volumes:
		One instance except io1/io2 edgecase
		are locked to AZ level
		gp2: IO increases if disk size increases.
		gp3/io1: increase IO independently
		
	Migrate ---> snapshot----> restore snapshot to another AZ.
	EBS backups use IO and not run during app runing a lot traffic.
	Root EBS vol gets terminated by defualt but can be disabled.
	
	EFS:
		Mounting 100s of instances across AZ.
		EFS share website files.
		Only for linux.
		
		EFS has a higher price point for EBS.
		Level storage tiers for cost savings.
		
		************EFS v.s EBS v.s instance store**********
		
	
	========Scalability and high availability===============
	Vertical scalability:
		common for non distributed systems like db
		RDS, elasticache 
		limited
		
	Horizontal scalability:
		Distributed system. common for web app modren apps.
		Auto Scaling Group or load balancer
		
	t2.nano 0.5g ram 1vcpu,
	u-12tb1.metal - 12.3tb ram 448 vcpu
	
	=======ELB=======
	
		load balances servers that forward traffic to multiple servers downstream.
	
			Spread load across multiple downstream instances.
			expose a single point of access (DNS)
			Seamless handling of failures.
			Regular health checks
			provide SSL to websites.
			Enforce stickiness with cookies.
			High availability across zones
			Seperate public traffic from private traffic
			
	ELB
		Managed load balancer.
			AWS handles it and upgrates and also configuration knobs and tweaking.
			
		No brainer to use as costs less than using own load balancer.
		Integrated with many AWS offerings.
			EC2, EC2 Auto Scaling
			ACM, CloudWatch
			Route 53,AWS WAF etc.
			
	---Health Checks---
		Ensure EC2 working properly
		Crucial for ELB.
		Done by port and route to check
			e.g /health port 4567 protocol HTTP
			if not 200 then unhealthy wont send traffic.
			
	-----Classic Load Balancer -(old gen v1 2009) CLB-----
		HTTP,HTTPS,TCP,SSL	Deperecated
		
	-----Application Load Balancer (v2) 2016 - ALB----
		HTTP,HTTPS,WebSocket
			
		Layer 7 (HTTP)
		Load balancer to multiple HTTP applications across machines (target groups)
		Load balancer to multiple applications on same machine.
		Support redirects (from HTTP to HTTPS eg)
		
		Routing based on path in url (example.com/users & example.com/posts)
				based on hostname in url (one.example.com)
				based on Query String,Headers. (as,example.com/users?id=123&order=false_
		
		****ALB are a great fit for micro services and container based apps (docker and amazon ecs)
		**Has a port mapping feature to redirect to a dynamic port in ECS
		in comparison we'd need multiple classic LB per app
		
		--Target Groups--
		
			- EC2 instances - HTTP
			- ECS task - HTTP
			- Lambda Functions - HTTP Request translated to JSON
			- IP Addresses - must be private IPs
			
			ALB can route to multiple target groups. Health checks are at target group lvl

		Get fixed hostname
		App servers dont see ip of client.
			****true IP inserted in the header X-Forwarded-For.
			We can slo get Port and proto from X-forwarded
			
		*****RULES
		-----REDIRECT on specific header http etc
		Priority 
		
		
	----Network Load Balancer (v2) 2007 -NLB----
		TCP,TLS,UDP,Secure (TCP), (UDP)
			Millions of req per seconds.
			less latency 100ms v.s 400ms ALB
		NLB has one FIXED IP for each AZ  and supports assigning Elastic IP (helpful for whitelisting specific IP)

		
		NLB for extreme performance, TCP or UDP traffic
		
		---TARGET Groups---
			EC2 Instances.
			IP Addresses - must be private IPs
			ALB ---> FIXED IP and ALB = RULES FOR HTTP.
			Health Checks support TCP,HTTP and HTTPS protocols
		
	----Gateway Load Balancer GWLB 2020----
		Operates at layer 3 (network layer) IP protocol.
		
	- Some lb can be internal (Private) or external (Public)
	- Deploy,scale and manage fleet of 3rd party network virtual appliances in AWS
	
	- ****Firewalls, intrusion Detection and prevention systems, Deep Packet Inspection systems,
		payload manipulation.
	
	- Combines the following functions:
		Transparent Network Gateway: single entry/exit for all traffic.
		Load Balancer - distribute traffic to ur Virtual Appliances.
	**Uses the GENEVE protocol on port 6081
	
	
	---TARGET GROUPS---
		EC2 INSTANCES
		IP Addresses - must be private IPs
		
	---Security groups ELB---
	
	User Access anywhere from HTTPS
	EC2 HTTP restricted to Load Balancer.
		EC2 Allow traffic only if coming from load balancer
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	AWS Cloud9  ---> Code Editor
	
	AWS Amplify CLI.
	
		AWS Amplify is everything you need to build web and mobile apps. Easy to start, easy to scale.
		It creates a top level directory called amplify that stores your backend definition. 
		It creates a file called aws-exports.js in the src directory that holds all the configuration for the services you create with Amplify. 
		
		amplify add hosting
		rerun app using (manual)
			amplify publish
	
	SAM
		Serverless App Model -> ez to deploy serverless infra 
		AWS SAM defines a set of resources that describe common components of serverless applications.
		
		sam build
		sam deploy --guided


	--Monitoring--
		most imp for lambda functions:
			Errors:
			Execution Time:
			Throttling
		
		In AWS Lambda, the default logging service is Amazon CloudWatch.
			each instance of lambda function has a dedicated log stream.
		
		
	
	Lambda authorizer
		A Lambda authorizer is an API Gateway feature that uses a Lambda function to control
		access to your API. It is a way to add additional security to your API.
	
	-------- SERVERLESS ------------
	
	Software Release Process
		CI / CD		Continous Integration / Continous Deployment
		
		Source > Build > Test > Production
		
		Frameworks > AWS Native
			AWS Native: AWS SAM AWS SDK AWS AMPLIFY
			3rd party: Terraform serverless
			
	AWS SAM
		Transform templates:
			IaC for serverless applications
		AWS CLI
			local dev, build,package and deploy serverless app.
			
			Create ur app 
				init 
				build 
				local 
				logs 
				traces 
				sync
				
			Stack management
				validate 
				package
				delete 
				deploy
				pipeline
				publish
			
			
	AWS CloudFOrmation
	
	AWS SAM. 4 parts:
		Tells cloudformation this is a SAM template it needs to transform.
		Function config
		Permissions for functions
		API Gateway
		
	AWS SAM Pipeline.
		generates resources and config req to build cicd pipeline.
		supports:
			Github Actions
			Jenkins CI
			GitLab
			AWS CodeSuite
			
	AWS SAM Summary
		Define applications with fewer lines of code than cloudofrmation using serverless resource types.
		Supports All AWS CloudFormation Resources.
		Local testing by emulating Lambda and API Gateway
		Accelerate testing on cloud with same accelerate.
		Generate resources and ci cd pipeline.
		
	AWS CDK
		sdk for modeling cloud infrastructure as reusable components
			Abstraction
			Familiar
			Tool Support
			
			
	AWS Amplify
		accelerated and simplifies dev exp for full stack devs
		rich features to quickly create frontends.
		Generates cloudformation for backend
		CI/CD pipeline
		
		For mobile apps usually.
		
	With Lambda function you cant chain functions because they are meant to be stateless . T
	here is another service called AWS StepFunction which you can use to create the orchestration and chain multiple lambda functions and other services. 
	
	There is another way to send message to other lambda function called Lambda Destinations
	- however, AWS StepFunctions is still preferred because it covers a lot more services than just lambda, and have native integration with the services. 
	
	best practices depends - if you are building an event driven architecture, you can either push a success message
	(with context) to a queue or kafka stream may be - and let the listener on the other end take care of the
	message. This way they will be loosely coupled. Aws step function for tight coupling if uk what to do
	
	
	Config management tools
	
	Static 
		Config file on s3 or code repo.
			App can download config on start from S3
			Works for non confidential data.
		AWS Systems Manager Parameter Store
			Hierarchical storage, sensitive data
			Supports data validation
			No complex data types
		AWS Secrets Manager
			secrets with rotation
		
	Dynamic
		AWS App Config.
			flags
			Source Control.
			
	Best practices.
		Automate config changes through pipeline.
		Use default config values in code
		Consider caching dynamic config info
		Avoid configuration bloat
			Periodically review and clean up old configuration.
	
	
	Make sure everything works.
	
		AWS Lambda functions -> 15min or less
								No code issues -> 3rd party ensure if it works
			3rd party services. 	can test with 3rd party
			Manual QA
			Safe deployments
			
	Deployment Strategies.
		All at once
			All changes at the same time.
			If any issues --> rollback
			Risk of downtime.
			Fastest way of deployment.
			Better for low concurrency workloads and dev/staging env
			
		Blue/Green
			Deploy to a new stack/switch traffic to new stack.
			Observing near stack go back to old stack if error.
			Reduces downtime.
			Medium Concurrency.
			
		Canary
			Deploy changes to a new stack.
			Send like 10-30% of traffic to new stack.
			Observe Increase traffic slowly. Downtime impacts only fraction of users.
			Better for high concurrency workloads.
			
	Lambda Versions and aliases.
		Versions immutable snapshots of a function code + config
		Alias pointer to a version	Can change alias to another version once confirmed.
		
	DNS with route53.
		Diff traffic directed to diff places according to diff geographical regions.
		Blue/Green and Canary
		
	Diff strats for dif fstages.
		Dev		Stage		Prod
		AllatOnce 		Canary at Linear10%Every1Min
	
	use canary releases to get tech and business feedback.
	
	SECURITY IN SERVERLESS:
		 shifts security Responsibility towards AWS 
		 and Left security shifts to Organization.
		
	Security is a shared responsibility ---> customer + AWS
	Serverless ---> Shigts a lot more to aws customer only IAM customer functions and resource fdonifg
	AWS compute scaling up and down network infra regions etc.
	
	Controll access to services with IAM
		- Control plane actions -> manage resources like createFunciton updateStateMachine.
		
		- Data plane actions execute on dialy business 
			Invoke 
			PutEvents
		
	Lambda Function Isolation
		Function runs in dedicated sandbox
	sandbox reuse:
		may be reused b/w invocations = improve latency and reuse prev initialized connections.
	
		Use caution when storing sensitive data in memory or /tmp
	
	Traditional approach
		Heavy emphasis on perimeter security and alarms.
		apps deployed within secured perimeter.
		
	Modern approach.
		Implement defense in depth.
		Secure each component of the workload
		Focus on IAM.
		Apply perimiter security if exposed to internet.
		Leverage AWS WAF, API Gateway.
		Managed services provide a strong basis.
	
	Least Privilege
		**Be specific
		Function Policy:
			Who can invoke function 
			
		Execution Policy:
			What can the function do?
	
	
	Defense in Depth:
		Access control and data path protection
	
		SQS encrypted by default.
		ABAC support in SQS.
		SNS data protection -> discover and protect sensitive data in motion
		
	---retrieve secrets in lambda functions---
		AWS Secrets Manager:
			Init once then invocation:
				Uses secrets.
				Across invocation stash db? or not? mostly not understand service.
				
	validate untrusted event payloads.
		Validate input before processing before parsing.
		Use Strict typing
		Consider for all event sources.
	
		API gateway has many options
	
	Use a framework!
		empowers devs to safely create policies.
		
	AWS Config ProActive controls.
		proactive/continously monitor instances.
		
	Code scanning with amazon inspector.
		Scan for vulnerabilities in env
			Standard scans/ code scans.
		Proactively monitor.
		
	Lambda functions always run in VPCS owned by service team.
		Only neded if VPC resource access needed or must meet a security control.
		
	Amazon GuardDuty
	
	---------Serverless Observability-------
	traditional monitoring layers:
		Business and Application + Data	mostly concerned for customers.
		Rest AWS in serverless.
		
	monitoring more than failures:
	is it behaving as expected? usage? business impact?
	
	Observability:
		Metrics Logs Traces(trace user actions)
		
	AWS Observability tools.
		AWS CloudWatch logs. CW Metrics. X ray
	
	CloudWatch
		Collect 
		
		Monitor 
		
		Act 
		
		Analyze
	
	CloudWatch Logs.
		Metric FIlters:
			Metrics based on log filters e.g count of 4xx errors
			Jump to logs that generated metric.
		Lambda Logging.
		API Gateway Rest logging.
		
		Standard Structured Logging.
			json -> Send it to cloudwatch log 
	
	
	0311-433331